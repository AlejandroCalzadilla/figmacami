<div class="editor-container">
  <!-- Sidebar de Componentes -->
  <div class="components-sidebar">
    <div class="sidebar-title">Componentes Flutter</div>
    <div class="component-category">
      <div class="category-title">Layout</div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'Container')">
        <div class="component-icon">□</div>
        <div class="component-name">Container</div>
      </div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'Column')">
        <div class="component-icon">||</div>
        <div class="component-name">Column</div>
      </div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'Row')">
        <div class="component-icon">=</div>
        <div class="component-name">Row</div>
      </div>
    </div>
    <div class="component-category">
      <div class="category-title">Widgets</div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'Text')">
        <div class="component-icon">T</div>
        <div class="component-name">Text</div>
      </div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'ElevatedButton')">
        <div class="component-icon">B</div>
        <div class="component-name">ElevatedButton</div>
      </div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'Image')">
        <div class="component-icon">I</div>
        <div class="component-name">Image</div>
      </div>
      <div class="component-item" draggable="true"
           (dragstart)="dragStart($event, 'TextField')">
        <div class="component-icon">[]</div>
        <div class="component-name">TextField</div>
      </div>
    </div>
  </div>

  <!-- Área de Diseño Principal -->
  <div class="design-area">
    <div class="toolbar">
      <button class="toolbar-button" (click)="clearCanvas()">Limpiar</button>
      <button class="toolbar-button" (click)="toggleCode()">Ver Código</button>
      <button class="toolbar-button" (click)="exportCode()">Exportar</button>
    </div>
    <div class="canvas-container">
      <div class="phone-mockup">
        <div class="phone-screen">
          <div class="drop-zone"
               (drop)="onDrop($event)"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)">
            <div *ngIf="components.length === 0" class="drop-zone-placeholder">
              Arrastra componentes aquí para comenzar
            </div>
            <ng-container *ngFor="let component of components; trackBy: trackById">
              <ng-container *ngTemplateOutlet="componentTemplate; context: { $implicit: component }"></ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Panel de Propiedades -->
  <div class="properties-panel">
    <div class="properties-title">Propiedades</div>
    <div *ngIf="!selectedComponent" style="color: #666; font-size: 13px; text-align: center; margin-top: 50px;">
      Selecciona un componente para ver sus propiedades
    </div>
    <div *ngIf="selectedComponent">
      <div class="property-group">
        <div class="property-label">Componente</div>
        <div style="color: #4fc3f7; font-weight: 600;">{{selectedComponent.type}}</div>
      </div>
      
      <!-- Propiedades de Text -->
      <div *ngIf="selectedComponent.type === 'Text'">
        <div class="property-group">
          <div class="property-label">Texto</div>
          <input type="text" class="property-input" [(ngModel)]="selectedComponent.properties.text" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Tamaño de Fuente</div>
          <input type="number" class="property-input" [(ngModel)]="selectedComponent.properties.fontSize" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Color</div>
          <input type="color" class="property-input" [(ngModel)]="selectedComponent.properties.color" (ngModelChange)="generateCode()">
        </div>
      </div>
      
      <!-- Propiedades de Container -->
      <div *ngIf="selectedComponent.type === 'Container'">
        <div class="property-group">
          <div class="property-label">Ancho</div>
          <input type="number" class="property-input" [(ngModel)]="selectedComponent.properties.width" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Alto</div>
          <input type="number" class="property-input" [(ngModel)]="selectedComponent.properties.height" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Color de Fondo</div>
          <input type="color" class="property-input" [(ngModel)]="selectedComponent.properties.color" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Padding</div>
          <input type="number" class="property-input" [(ngModel)]="selectedComponent.properties.padding" (ngModelChange)="generateCode()">
        </div>
      </div>
      
      <!-- Propiedades de ElevatedButton -->
      <div *ngIf="selectedComponent.type === 'ElevatedButton'">
        <div class="property-group">
          <div class="property-label">Texto</div>
          <input type="text" class="property-input" [(ngModel)]="selectedComponent.properties.text" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Color de Fondo</div>
          <input type="color" class="property-input" [(ngModel)]="selectedComponent.properties.backgroundColor" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Color de Texto</div>
          <input type="color" class="property-input" [(ngModel)]="selectedComponent.properties.textColor" (ngModelChange)="generateCode()">
        </div>
      </div>
      
      <!-- Propiedades de Image -->
      <div *ngIf="selectedComponent.type === 'Image'">
        <div class="property-group">
          <div class="property-label">URL de Imagen</div>
          <input type="text" class="property-input" [(ngModel)]="selectedComponent.properties.src" 
                 placeholder="https://ejemplo.com/imagen.jpg" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Ancho</div>
          <input type="number" class="property-input" [(ngModel)]="selectedComponent.properties.width" (ngModelChange)="generateCode()">
        </div>
        <div class="property-group">
          <div class="property-label">Alto</div>
          <input type="number" class="property-input" [(ngModel)]="selectedComponent.properties.height" (ngModelChange)="generateCode()">
        </div>
      </div>
      
      <!-- Propiedades de TextField -->
      <div *ngIf="selectedComponent.type === 'TextField'">
        <div class="property-group">
          <div class="property-label">Placeholder</div>
          <input type="text" class="property-input" [(ngModel)]="selectedComponent.properties.placeholder" (ngModelChange)="generateCode()">
        </div>
      </div>
      
      <!-- Propiedades de Column/Row -->
      <div *ngIf="selectedComponent.type === 'Column' || selectedComponent.type === 'Row'">
        <div class="property-group">
          <div class="property-label">Main Axis Alignment</div>
          <select class="property-input" [(ngModel)]="selectedComponent.properties.mainAxisAlignment" (ngModelChange)="generateCode()">
            <option value="start">Start</option>
            <option value="center">Center</option>
            <option value="end">End</option>
            <option value="spaceAround">Space Around</option>
            <option value="spaceBetween">Space Between</option>
            <option value="spaceEvenly">Space Evenly</option>
          </select>
        </div>
        <div class="property-group">
          <div class="property-label">Cross Axis Alignment</div>
          <select class="property-input" [(ngModel)]="selectedComponent.properties.crossAxisAlignment" (ngModelChange)="generateCode()">
            <option value="start">Start</option>
            <option value="center">Center</option>
            <option value="end">End</option>
            <option value="stretch">Stretch</option>
          </select>
        </div>
        <div class="property-group">
          <div class="property-label">Elementos Hijos</div>
          <div style="color: #666; font-size: 12px;">
            {{selectedComponent.children?.length || 0}} elemento(s)
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Panel de Código -->
  <div class="code-panel" [class.visible]="showCode">
    <div class="code-header">Código Flutter Generado</div>
    <div class="code-content">
      <pre>{{generatedCode}}</pre>
    </div>
  </div>
</div>

<!-- Template recursivo para componentes -->
<ng-template #componentTemplate let-component>
  <div class="flutter-container"
       [class.selected]="selectedComponent && selectedComponent.id === component.id"
       [class.layout-container]="canReceiveChildren(component)"
       (click)="selectComponent(component, $event)">
    
    <button class="delete-btn" (click)="deleteComponent(component.id); $event.stopPropagation()">×</button>
    
    <ng-container [ngSwitch]="component.type">
      <!-- Container -->
      <div *ngSwitchCase="'Container'"
           class="rendered-container"
           [ngStyle]="{
             'background-color': component.properties.color,
             'width.px': component.properties.width,
             'height.px': component.properties.height,
             'padding.px': component.properties.padding,
             'border-radius.px': component.properties.borderRadius
           }">
        <ng-container *ngIf="component.child">
          <ng-container *ngTemplateOutlet="componentTemplate; context: { $implicit: component.child }"></ng-container>
        </ng-container>
      </div>
      
      <!-- Text -->
      <div *ngSwitchCase="'Text'" class="flutter-text"
           [ngStyle]="{
             'font-size.px': component.properties.fontSize,
             'color': component.properties.color,
             'font-weight': component.properties.fontWeight
           }">
        {{component.properties.text}}
      </div>
      
      <!-- ElevatedButton -->
      <button *ngSwitchCase="'ElevatedButton'" class="flutter-button"
              [ngStyle]="{
                'background-color': component.properties.backgroundColor,
                'color': component.properties.textColor
              }">
        {{component.properties.text}}
      </button>
      
      <!-- Image -->
      <div *ngSwitchCase="'Image'" class="flutter-image"
           [ngStyle]="{
             'width.px': component.properties.width,
             'height.px': component.properties.height
           }">
        <span *ngIf="!component.properties.src">
          Imagen ({{component.properties.width}}x{{component.properties.height}})
        </span>
        <img *ngIf="component.properties.src" [src]="component.properties.src"
             style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
      </div>
      
      <!-- TextField -->
      <input *ngSwitchCase="'TextField'" type="text" class="flutter-textfield"
             [ngStyle]="{'border': '1px solid #ddd', 'border-radius': '4px', 'padding': '12px'}"
             [placeholder]="component.properties.placeholder">
      
      <!-- Column -->
      <div *ngSwitchCase="'Column'" 
           class="flutter-column layout-drop-zone"
           [class.empty-layout]="!component.children || component.children.length === 0"
           (drop)="onDropInLayout($event, component)"
           (dragover)="onDragOver($event, component)"
           (dragleave)="onDragLeave($event)"
           [ngStyle]="{
             'justify-content': getFlexAlignment(component.properties.mainAxisAlignment),
             'align-items': getFlexAlignment(component.properties.crossAxisAlignment)
           }">
        
        <div *ngIf="!component.children || component.children.length === 0" 
             class="layout-placeholder">
          Arrastra widgets aquí para agregar a la columna
        </div>
        
        <ng-container *ngFor="let child of component.children; trackBy: trackById">
          <div class="layout-child-wrapper">
            <ng-container *ngTemplateOutlet="componentTemplate; context: { $implicit: child }"></ng-container>
            <button class="child-delete-btn" (click)="deleteComponent(child.id, component); $event.stopPropagation()">×</button>
          </div>
        </ng-container>
      </div>
      
      <!-- Row -->
      <div *ngSwitchCase="'Row'" 
           class="flutter-row layout-drop-zone"
           [class.empty-layout]="!component.children || component.children.length === 0"
           (drop)="onDropInLayout($event, component)"
           (dragover)="onDragOver($event, component)"
           (dragleave)="onDragLeave($event)"
           [ngStyle]="{
             'justify-content': getFlexAlignment(component.properties.mainAxisAlignment),
             'align-items': getFlexAlignment(component.properties.crossAxisAlignment)
           }">
        
        <div *ngIf="!component.children || component.children.length === 0" 
             class="layout-placeholder">
          Arrastra widgets aquí para agregar a la fila
        </div>
        
        <ng-container *ngFor="let child of component.children; trackBy: trackById">
          <div class="layout-child-wrapper">
            <ng-container *ngTemplateOutlet="componentTemplate; context: { $implicit: child }"></ng-container>
            <button class="child-delete-btn" (click)="deleteComponent(child.id, component); $event.stopPropagation()">×</button>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>
</ng-template>